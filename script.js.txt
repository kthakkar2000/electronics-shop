<!-- FILE: script.js -->
description_gu:"આ આધુનિક અને વિશ્વસનીય 7 કિગ્રા ફ્રન્ટ લોડ વોશિંગ મશીન છે. નાનું/મધ્યમ પરિવાર માટે યોગ્ય — ઝડપી સાયકલ અને ઓછા વીજ ઉપભોગ સાથે."
}
};


function getQueryParam(name){
const u = new URL(location.href);
return u.searchParams.get(name);
}


const id = getQueryParam('id') || 'washing-machine-001';
const product = products[id] || products['washing-machine-001'];


let LANG = (new URL(location.href).searchParams.get('lang') || 'en');
const langSelect = document.getElementById('langSelect');
if(langSelect){
langSelect.value = LANG;
langSelect.addEventListener('change',(e)=>{
LANG = e.target.value;
applyLanguageToUI();
const u = new URL(location.href);
u.searchParams.set('lang', LANG);
history.replaceState(null,'',u.toString());
initRecognition();
});
}


function applyLanguageToUI(){
if(LANG==='gu'){
document.getElementById('title').textContent = product.title_gu || product.title;
document.getElementById('description').textContent = product.description_gu || product.description;
document.getElementById('askBtn').textContent = 'આ ઉત્પાદન વિશે પૂછો';
document.getElementById('buyBtn').textContent = 'ખરીદ / પૂછપરછ';
const specsWrap=document.getElementById('specs');specsWrap.innerHTML='';
const srcSpecs=product.specs_gu||product.specs;
for(const k in srcSpecs){
const div=document.createElement('div');div.className='spec';
div.innerHTML=`<strong>${k}</strong><div style="color:var(--muted);margin-top:6px">${srcSpecs[k]}</div>`;
specsWrap.appendChild(div);
}
} else {
document.getElementById('title').textContent=product.title;
document.getElementById('description').textContent=product.description;
document.getElementById('askBtn').textContent='Ask about this product';
document.getElementById('buyBtn').textContent='Buy / Enquire';
const specsWrap=document.getElementById('specs');specsWrap.innerHTML='';
const srcSpecs=product.specs;
for(const k in srcSpecs){
const div=document.createElement('div');div.className='spec';
div.innerHTML=`<strong>${k}</strong><div style="color:var(--muted);margin-top:6px">${srcSpecs[k]}</div>`;
specsWrap.appendChild(div);
}
}
}


applyLanguageToUI();


document.getElementById('sku').textContent='SKU: '+product.sku;
document.getElementById('price').textContent='₹'+product.price.toLocaleString('en-IN');
document.getElementById('pageUrl').textContent=location.origin+location.pathname+'?id='+encodeURIComponent(product.id);


const mainImg=document.getElementById('mainImg');
const thumbs=document.getElementById('thumbs');
mainImg.src=product.images[0];
product.images.forEach((src,i)=>{
const img=document.createElement('img');
img.src=src;
if(i===0) img.classList.add('active');
img.onclick=()=>{mainImg.src=src;document.querySelectorAll('.thumbs img').forEach(t=>t.classList.remove('active'));img.classList.add('active');}
thumbs.appendChild(img);
});


const targetUrl=encodeURIComponent(location.origin+location.pathname+'?id='+product.id);
document.getElementById('qrImg').src=`https://chart.googleapis.com/chart?cht=qr&chs=300x300&chl=${targetUrl}`;


const modal=document.getElementById('modalBackdrop');
const askBtn=document.getElementById('askBtn');
const closeModal=document.getElementById('closeModal');
const chatArea=document.getElementById('chatArea');
const micBtn=document.getElementById('micBtn');
const recStatus=document.getElementById('recStatus');
const sendBtn=document.getElementById('sendBtn');
const manualInput=document.getElementById('manualInput');


askBtn.onclick=()=>{openModal();speakText(LANG==='gu'?"મારા ઇલેક્ટ્રોનિક્સ દુકાનમાં આપનું સ્વાગત છે. હું આ પ્રોડક્ટ વિશે કેવી રીતે મદદ કરી શકું?":"Welcome to my electronics shop. How can I help you about this product?");addBotMsg(LANG==='gu'?"સ્વાગત છે! આ પ્રોડક્ટ વિશે તમે શું જાણવા માંગો છો? (કિંમત, રંગ, ડિલિવરી, લાભો)":"Welcome! How can I help you about this product? (Try: price, color, delivery, advantages)")};
closeModal.onclick=()=>{closeModalFunc()};


function openModal(){modal.style.display='flex';chatArea.innerHTML='';recStatus.textContent='Idle';}
function closeModalFunc(){modal.style.display='none';stopRecognition();}


function addUserMsg(text){const d=document.createElement('div');d.className='msg me';d.innerHTML=`<div class="bubble">${escapeHtml(text)}</div>`;chatArea.appendChild(d);chatArea.scrollTop=chatArea.scrollHeight;}
function addBotMsg(text){const d=document.createElement('div');d.className='msg';d.innerHTML=`<div class="bubble bot">${escapeHtml(text)}</div>`;chatArea.appendChild(d);chatArea.scrollTop=chatArea.scrollHeight;}
function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',"'":'&#39;'}[m]));}


function speakText(txt){if(!('speechSynthesis'in window))return;try{const u=new SpeechSynthesisUtterance(txt);u.lang=(LANG==='gu')?'gu-IN':'en-US';window.speechSynthesis.cancel();window.speechSynthesis.speak(u);}catch(e){console.warn(e)}}


function answerQuestion(q){const text=q.toLowerCase();if(LANG==='gu'){if(/કિંમત|price|cost/.test(text)){return `આ મોડેલ (${product.title_gu||product.title}) ની કિંમત ₹${product.price.toLocaleString('en-IN')} છે.`;}if(/રંગ|color|colour/.test(text)){return `આ મોડેલ ઉપલબ્ધ છે: ${(product.colors_gu||product.colors).join(', ')}.`;}if(/ડિલિવરી|deliver|delivery/.test(text)){return `અંદાજિત વિતરણ સમય: ${(product.specs_gu&&product.specs_gu["Delivery"])||product.specs["Delivery"]}`;}if(/લાભ|advantage|benefit|feature/.test(text)){return `મુખ્ય લાભ: ${(product.advantages_gu||product.advantages).join('; ')}.`;}if(/capacity|કિગ્રા/.test(text)){return `કેપેસિટી: ${(product.specs_gu&&product.specs_gu["Capacity"])||product.specs["Capacity"]}`;}if(/વોરંટી|guarantee|warranty/.test(text)){return `વોરંટી: ${(product.specs_gu&&product.specs_gu["Warranty"])||product.specs["Warranty"]}`;}return `માફ કરશો, તમે કિંમત, રંગ, ડિલ