<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kalindi ‚Äî Product Voice Assistant</title>
  <style>
    :root{
      --bg:#0f1723;
      --card:#0b1220;
      --muted:#9aa4b2;
      --accent1:#7c3aed;
      --accent2:#06b6d4;
      --glass: rgba(255,255,255,0.03);
      font-family: Inter, system-ui, -apple-system, Roboto, 'Segoe UI', Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg) 0%, #081018 100%);color:#e6eef6}
    .container{max-width:460px;margin:18px auto;padding:16px}

    header{display:flex;align-items:center;gap:12px;margin-bottom:12px;justify-content:space-between}
    .left{display:flex;align-items:center;gap:12px}
    .logo-img{width:56px;height:56px;border-radius:10px;overflow:hidden;flex-shrink:0;box-shadow:0 4px 14px rgba(2,6,23,0.6)}
    .logo-img img{width:100%;height:100%;object-fit:contain;background:white}
    .shop{font-size:16px;font-weight:700}
    .sub{font-size:12px;color:var(--muted)}

    /* language toggle */
    .lang-switch{display:flex;gap:8px}
    .lang-btn{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted);font-weight:700;cursor:pointer}
    .lang-btn.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;box-shadow:0 6px 18px rgba(6,182,212,0.08)}

    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:18px;padding:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}

    .gallery{position:relative;overflow:hidden;border-radius:14px}
    .slides{display:flex;transition:transform .36s cubic-bezier(.2,.9,.2,1)}
    .slides img{width:100%;height:320px;object-fit:cover;flex-shrink:0}
    .dots{display:flex;gap:6px;position:absolute;left:12px;bottom:10px}
    .dot{width:9px;height:9px;border-radius:6px;background:rgba(0,0,0,0.35);backdrop-filter:blur(6px)}
    .dot.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));box-shadow:0 4px 12px rgba(92,52,204,0.24)}

    .bot{display:flex;gap:10px;align-items:center;margin-top:14px;padding:10px;border-radius:12px;background:linear-gradient(90deg, rgba(124,58,237,0.08), rgba(6,182,212,0.05));}
    .mic{width:56px;height:56px;border-radius:12px;background:linear-gradient(180deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;font-size:18px;cursor:pointer}
    .mic.listening{box-shadow:0 8px 30px rgba(124,58,237,0.28);transform:scale(1.03)}
    .bot-info{flex:1}
    .bot-title{font-weight:700}
    .bot-sub{font-size:13px;color:var(--muted);margin-top:4px}
    .transcript{margin-top:8px;font-size:14px;color:var(--muted);min-height:28px}

    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

    @media (max-width:420px){
      .slides img{height:260px}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="left">
        <div class="logo-img"><img src="assets/ktpl new logo.png" alt="Kalindi logo" /></div>
        <div>
          <div class="shop">Kalindi Tradelinks Pvt Ltd</div>
          <div class="sub">Home Appliances ‚Ä¢ Washing Machine</div>
        </div>
      </div>

      <div class="lang-switch" role="tablist" aria-label="Language switch">
        <button class="lang-btn active" id="btn-en" role="tab" aria-selected="true">English</button>
        <button class="lang-btn" id="btn-gu" role="tab" aria-selected="false">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</button>
      </div>
    </header>

    <main class="card">

      <main class="card">
<div class="gallery" id="gallery">
<div class="slides" id="slides">
<img src="assets/wm1.jpg" alt="product image 1" />
<img src="assets/wm2.jpg" alt="product image 2" />
<img src="assets/wm3.jpg" alt="product image 3" />
<img src="assets/wm4.jpg" alt="product image 4" />
<img src="assets/wm5.jpg" alt="product image 5" />
</div>
<div class="dots" id="dots"></div>
</div>

      <div class="bot" role="region" aria-label="Product voice assistant">
        <div class="mic" id="mic" title="Tap to speak">üéôÔ∏è</div>
        <div class="bot-info">
          <div class="bot-title" id="assistant-title">Product Voice Assistant</div>
          <div class="bot-sub" id="assistant-sub">Tap the mic and ask about price, warranty, stock, cleaning or delivery.</div>
          <div class="transcript" id="transcript">Assistant ready. Select language and tap mic to ask.</div>
        </div>
      </div>

    </main>

    <footer>¬© Kalindi Tradelinks Pvt Ltd</footer>
  </div>

  <script>
    // SLIDER
    const slides = document.getElementById('slides');
    const images = slides.querySelectorAll('img');
    const dots = document.getElementById('dots');
    let idx = 0;
    function buildDots(){
      images.forEach((_,i)=>{
        const d = document.createElement('div');
        d.className = 'dot' + (i===0 ? ' active' : '');
        d.addEventListener('click', ()=> { idx = i; update(); });
        dots.appendChild(d);
      });
    }
    function update(){
      slides.style.transform = `translateX(${-idx * 100}%)`;
      Array.from(dots.children).forEach((d,i)=> d.classList.toggle('active', i===idx));
    }
    buildDots();
    setInterval(()=> { idx = (idx + 1) % images.length; update(); }, 4500);

    // LANGUAGE TOGGLE
    let currentLang = 'en'; // 'en' or 'gu'
    const btnEn = document.getElementById('btn-en');
    const btnGu = document.getElementById('btn-gu');
    function setLang(lang){
      currentLang = lang;
      if(lang==='en'){
        btnEn.classList.add('active'); btnEn.setAttribute('aria-selected','true');
        btnGu.classList.remove('active'); btnGu.setAttribute('aria-selected','false');
        document.getElementById('assistant-sub').textContent = 'Tap the mic and ask about price, warranty, stock, cleaning or delivery.';
        document.getElementById('assistant-title').textContent = 'Product Voice Assistant';
      } else {
        btnGu.classList.add('active'); btnGu.setAttribute('aria-selected','true');
        btnEn.classList.remove('active'); btnEn.setAttribute('aria-selected','false');
        document.getElementById('assistant-sub').textContent = '‡™Æ‡™æ‡™á‡™ï ‡™¶‡™¨‡™æ‡™µ‡´ã ‡™Ö‡™®‡´á ‡™ï‡™ø‡™Ç‡™Æ‡™§, ‡™µ‡´ã‡™∞‡™Ç‡™ü‡´Ä, ‡™∏‡´ç‡™ü‡´ã‡™ï, ‡™Ö‡™•‡™µ‡™æ ‡™°‡™ø‡™≤‡™ø‡™µ‡™∞‡´Ä ‡™µ‡™ø‡™∂‡´á ‡™™‡´Ç‡™õ‡´ã.';
        document.getElementById('assistant-title').textContent = '‡™™‡´ç‡™∞‡´ã‡™°‡™ï‡´ç‡™ü ‡™µ‡´ã‡™á‡™∏ ‡™Ü‡™∏‡™ø‡™∏‡´ç‡™ü‡™®‡´ç‡™ü';
      }

      // if recognition exists, update recognition.lang when restarted
      if(recognition) recognition.lang = (lang==='en' ? 'en-IN' : 'gu-IN');
    }
    btnEn.addEventListener('click', ()=> setLang('en'));
    btnGu.addEventListener('click', ()=> setLang('gu'));

    // CANNED RESPONSES (English)
    const cannedEn = [
      { q:/price|cost|‚Çπ|rupee/i, a:'The price of this model is sixty five thousand rupees only.' },
      { q:/stock|available/i, a:'This model has only 4 pieces left in stock. We also offer EMI and exchange options in-store.' },
      { q:/warrant(?:y|ies)|guarantee/i, a:'This product comes with a two year manufacturer warranty covering defects and parts.' },
      { q:/capacity|kg|weight/i, a:'The machine has a 12 kilogram capacity ‚Äî suitable for medium families.' },
      { q:/rpm|spin|speed/i, a:'Maximum spin speed is 1200 RPM which helps remove more water and reduce drying time.' },
      { q:/energy|star/i, a:'This is a 5-star energy rated appliance ‚Äî very efficient on power consumption.' },
      { q:/how to clean|clean|care/i, a:'Use a mild detergent, run monthly drum clean cycle and wipe the door seal to avoid residue.' },
      { q:/brand|company|model/i, a:'This model is from a reputed brand known for durability and advanced features.' },
      { q:/size|dimension|height|width|depth/i, a:'The machine measures about 85 cm in height, 60 cm in width and 55 cm in depth.' },
      { q:/water|litre|consumption/i, a:'This model consumes approximately 60 liters of water per full wash cycle.' },
      { q:/noise|sound|db|decibel/i, a:'The machine operates quietly: around 52 dB during wash and 72 dB during spin.' },
      { q:/delivery|install|setup/i, a:'Free delivery and installation are provided within city limits.' },
      { q:/offer|discount|deal|sale/i, a:'We currently have a festive discount available. Please check in-store for final price.' },
      { q:/service|repair|support|help/i, a:'We provide doorstep service and free checkups during warranty period.' },
      { q:/exchange|old machine|return/i, a:'You can exchange your old appliance and get up to ‚Çπ5,000 off.' },
      { q:/.*/, a:'Sorry, I do not have that exact information. You can ask about price, capacity, warranty or cleaning and I will answer.' }
    ];

    // CANNED RESPONSES (Gujarati) ‚Äî regex matches common Gujarati words
    const cannedGu = [
      { q:/‡™ï‡™ø‡™Ç‡™Æ‡™§|‡™¶‡™æ‡™Æ|‡™∞‡´Ç|‚Çπ/i, a:'‡™Ü ‡™Æ‡´ã‡™°‡´á‡™≤‡™®‡´Ä ‡™ï‡™ø‡™Ç‡™Æ‡™§ ‡™∞‡´Ç. 65,000 ‡™õ‡´á. ‡™∏‡´ç‡™ü‡´ã‡™∞‡™Æ‡™æ‡™Ç EMI ‡™Ö‡™®‡´á ‡™è‡™ï‡´ç‡™∏‡™ö‡´á‡™®‡´ç‡™ú ‡™â‡™™‡™≤‡™¨‡´ç‡™ß ‡™õ‡´á.' },
      { q:/‡™∏‡´ç‡™ü‡´ã‡™ï|‡™â‡™™‡™≤‡™¨‡´ç‡™ß|‡™Æ‡´ã‡™ú‡´Å–¥–∞–∫/i, a:'‡™Ü ‡™Æ‡´ã‡™°‡´á‡™≤‡™®‡™æ ‡™∏‡´ç‡™ü‡´ã‡™ï‡™Æ‡™æ‡™Ç ‡™´‡™ï‡´ç‡™§ 4 ‡™™‡´Ä‡™∏ ‡™¨‡™æ‡™ï‡´Ä ‡™õ‡´á. ‡™∏‡´ç‡™ü‡´ã‡™∞‡™Æ‡™æ‡™Ç EMI ‡™Ö‡™®‡´á ‡™è‡™ï‡´ç‡™∏‡™ö‡´á‡™®‡´ç‡™ú ‡™â‡™™‡™≤‡™¨‡´ç‡™ß ‡™õ‡´á.' },
      { q:/‡™µ‡´ã‡™∞‡™Ç‡™ü‡´Ä|‡™ó‡´á‡™∞‡™®‡´ç‡™ü‡´Ä|‡™ù‡™∞‡´Å‡™∞|‡™µ‡´ã‡™∞‡™Ç‡™ü‡´Ä/i, a:'‡™Ü ‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™® ‡™∏‡™æ‡™•‡´á 2 ‡™µ‡™∞‡´ç‡™∑‡™®‡´Ä ’°÷Ä’ø’°’§÷Ä‡™ï ‡™µ‡´ã‡™∞‡™Ç‡™ü‡´Ä ‡™Æ‡™≥‡´á ‡™õ‡´á ‡™ú‡´á ‡™ñ‡™æ‡™Æ‡´Ä ‡™Ö‡™®‡´á ‡™≠‡™æ‡™ó‡´ã‡™®‡´á ‡™¢‡™ï‡´á ‡™õ‡´á.' },
      { q:/‡™ï‡´ç‡™∑‡™Æ‡™§‡™æ|‡™ï‡™ø‡™ó‡´ç‡™∞‡™æ|‡™ï‡™ø‡™≤‡´ã‡™ó‡´ç‡™∞‡™æ‡™Æ|‡™ï‡™ø‡™ó‡´ç‡™∞‡™æ/i, a:'‡™Ü ‡™Æ‡™∂‡´Ä‡™®‡™®‡´Ä ‡™ï‡´ç‡™∑‡™Æ‡™§‡™æ 12 ‡™ï‡™ø‡™ó‡´ç‡™∞‡™æ ‡™õ‡´á ‚Äî ‡™Æ‡™ß‡´ç‡™Ø‡™Æ ‡™ï‡™¶‡™®‡´Ä ‡™™‡™∞‡™ø‡™µ‡™æ‡™∞ ‡™Æ‡™æ‡™ü‡´á ‡™Ø‡´ã‡™ó‡´ç‡™Ø.' },
      { q:/‡™∏‡´ç‡™™‡™ø‡™®|RPM|‡™∏‡´ç‡™™‡´Ä‡™°|‡™ó‡™§‡™ø/i, a:'‡™Æ‡™π‡™§‡´ç‡™§‡™Æ ‡™∏‡´ç‡™™‡™ø‡™® ‡™∏‡´ç‡™™‡´Ä‡™° 1200 RPM ‡™õ‡´á ‡™ú‡´á ‡™µ‡™ß‡´Å ‡™™‡™æ‡™£‡´Ä ‡™¶‡´Ç‡™∞ ‡™ï‡™∞‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™Æ‡™¶‡™¶ ‡™ï‡™∞‡´á ‡™õ‡´á.' },
      { q:/‡™è‡™®‡™∞‡´ç‡™ú‡´Ä|‡™∏‡´ç‡™ü‡™æ‡™∞|energy/i, a:'‡™Ü 5-‡™∏‡´ç‡™ü‡™æ‡™∞ ‡™è‡™®‡™∞‡´ç‡™ú‡´Ä ‡™∞‡´á‡™ü‡´á‡™° ‡™â‡™™‡™ï‡™∞‡™£ ‡™õ‡´á ‚Äî ‡™µ‡´Ä‡™ú ‡™ñ‡™∞‡´ç‡™ö‡™Æ‡™æ‡™Ç ‡™Ö‡™∏‡™∞‡™ï‡™æ‡™∞‡™ï.' },
      { q:/‡™∏‡™´‡™æ‡™à|‡™∏‡™æ‡™´|‡™ï‡´ç‡™≤‡´Ä‡™®|how to clean/i, a:'‡™π‡™≥‡™µ‡´ã ‡™°‡™ø‡™ü‡™∞‡´ç‡™ú‡™®‡´ç‡™ü ‡™µ‡™æ‡™™‡™∞‡´ã, ‡™Æ‡™æ‡™∏‡™ø‡™ï ‡™°‡´ç‡™∞‡™Æ ‡™ï‡´ç‡™≤‡´Ä‡™® ‡™ö‡™≤‡™æ‡™µ‡´ã ‡™Ö‡™®‡´á ‡™°‡´ã‡™∞ ‡™∏‡™ø‡™≤ ‡™∏‡™æ‡™´ ‡™∞‡™æ‡™ñ‡´ã.' },
      { q:/‡™¨‡´ç‡™∞‡™æ‡™®‡´ç‡™°|‡™ï‡™Ç‡™™‡™®‡´Ä|‡™Æ‡´ã‡™°‡´á‡™≤/i, a:'‡™Ü ‡™Æ‡´ã‡™°‡´á‡™≤ ‡™™‡´ç‡™∞‡™ñ‡´ç‡™Ø‡™æ‡™§ ‡™¨‡´ç‡™∞‡™æ‡™®‡´ç‡™°‡™®‡´Å‡™Ç ‡™õ‡´á ‡™ú‡´á ‡™ï‡™°‡™ï‡™æ‡™à ‡™Ö‡™®‡´á ‡™∏‡¥µ‡¥ø‡¥∂‡´á‡™∑‡™§‡™æ‡™ì ‡™Æ‡™æ‡™ü‡´á ‡™ú‡™æ‡™£‡´Ä‡™§‡´Å‡™Ç ‡™õ‡´á.' },
      { q:/‡™Æ‡´á‡™™|‡™Æ‡™æ‡™™|‡™â‡™Ç‡™ö‡™æ‡™à|‡™™‡™π‡´ã‡™≥‡™æ‡™à|‡™ä‡™Ç‡™°‡™æ‡™à|‡™°‡™æ‡™Ø‡™Æ‡´á‡™®‡´ç‡™∂‡™®/i, a:'‡™Æ‡™∂‡´Ä‡™®‡™®‡´Ä ‡™≤‡™Ç‡™¨‡™æ‡™à ‡™Ö‡™Ç‡™¶‡™æ‡™ú‡´á 85 ‡™∏‡´á‡™Æ‡´Ä, ‡™™‡™π‡´ã‡™≥‡™æ‡™à 60 ‡™∏‡´á‡™Æ‡´Ä ‡™Ö‡™®‡´á ‡™ä‡™Ç‡™°‡™æ‡™à 55 ‡™∏‡´á‡™Æ‡´Ä ‡™õ‡´á.' },
      { q:/‡™™‡™æ‡™£‡´Ä|‡™≤‡™ø‡™ü‡™∞|‡™™‡™æ‡™£‡´Ä‡™®‡´ã ‡™â‡™™‡™Ø‡´ã‡™ó/i, a:'‡™¶‡™∞‡´á‡™ï ‡™™‡´Ç‡™∞‡´ç‡™£ ‡™µ‡´ã‡™∂ ‡™∏‡™æ‡™Ø‡™ï‡™≤ ‡™Æ‡™æ‡™ü‡´á ‡™Ü‡™∂‡™∞‡´á 60 ‡™≤‡™ø‡™ü‡™∞ ‡™™‡™æ‡™£‡´Ä ‡™µ‡™™‡™∞‡™æ‡™Ø ‡™õ‡´á.' },
      { q:/‡™∂‡´ã‡™∞|‡™∏‡™Æ‡™æ‡™ö‡™æ‡™∞|‡™°‡´á‡™∏‡™ø‡™¨‡™≤|dB/i, a:'‡™ß‡´ã‡™µ‡™æ‡™®‡™æ ‡™∏‡™Æ‡™Ø‡´á ‡™Ü‡™∂‡™∞‡´á 52 dB ‡™Ö‡™®‡´á ‡™∏‡´ç‡™™‡™ø‡™® ‡™∏‡™Æ‡™Ø‡´á 72 dB ‡™≤‡™æ‡™ó‡´á ‡™õ‡´á ‚Äî ‡™∏‡™æ‡™Æ‡™æ‡™®‡´ç‡™Ø ‡™∞‡´Ä‡™§‡´á ‡™∂‡™æ‡™Ç‡™§.' },
      { q:/‡™°‡™ø‡™≤‡™ø‡™µ‡™∞‡´Ä|‡™á‡™®‡´ç‡™∏‡´ç‡™ü‡´ã‡™≤|‡™∏‡´á‡™ü‡™Ö‡™™/i, a:'‡™∂‡™π‡´á‡™∞‡™®‡´Ä ‡™Ö‡™Ç‡™¶‡™∞ ‡™Æ‡™´‡™§ ‡™°‡™ø‡™≤‡™ø‡™µ‡™∞‡´Ä ‡™Ö‡™®‡´á ‡™á‡™®‡´ç‡™∏‡´ç‡™ü‡´ã‡™≤‡´á‡™∂‡™® ‡™Ü‡™™‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™Ü‡™µ‡´á ‡™õ‡´á.' },
      { q:/‡™°‡™ø‡™∏‡´ç‡™ï‡™æ‡™â‡™®‡´ç‡™ü|‡™õ‡´Ç‡™ü|‡™°‡™ø‡™≤|‡™∏‡´á‡™≤/i, a:'‡™π‡™æ‡™≤‡™Æ‡™æ‡™Ç ‡™§‡™π‡´á‡™µ‡™æ‡™∞‡´ã‡™Æ‡™æ‡™Ç ‡™°‡™ø‡™∏‡´ç‡™ï‡™æ‡™â‡™®‡´ç‡™ü ‡™â‡™™‡™≤‡™¨‡´ç‡™ß ‡™õ‡´á. ‡™Ö‡™Ç‡™§‡™ø‡™Æ ‡™ï‡™ø‡™Ç‡™Æ‡™§ ‡™Æ‡™æ‡™ü‡´á ‡™∏‡´ç‡™ü‡´ã‡™∞‡™Æ‡™æ‡™Ç ‡™§‡™™‡™æ‡™∏‡´ã.' },
      { q:/‡™∏‡™∞‡´ç‡™µ‡™ø‡™∏|‡™∞‡™ø‡™™‡´á‡™∞|‡™∏‡™™‡´ã‡™∞‡´ç‡™ü|‡™Æ‡™¶‡™¶/i, a:'‡™µ‡´ã‡™∞‡™Ç‡™ü‡´Ä ‡™∏‡™Æ‡™Ø‡™ó‡™æ‡™≥‡™æ ‡™¶‡™∞‡™Æ‡™ø‡™Ø‡™æ‡™® ‡™°‡´ã‡™∞‡™∏‡´ç‡™ü‡´á‡™™ ‡™∏‡™∞‡´ç‡™µ‡™ø‡™∏ ‡™Ö‡™®‡´á ‡™Æ‡™´‡™§ ‡™ö‡´á‡™ï‡™Ö‡™™ ‡™Ü‡™™‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™Ü‡™µ‡´á ‡™õ‡´á.' },
      { q:/‡™è‡™ï‡´ç‡™∏‡™ö‡´á‡™®‡´ç‡™ú|‡™ú‡´Ç‡™®‡´Å‡™Ç|‡™è‡™ï‡´ç‡™∏|‡™ö‡´á‡™®‡´ç‡™ú/i, a:'‡™§‡™Æ‡´á ‡™§‡™Æ‡™æ‡™∞‡´Å‡™Ç ‡™ú‡´Ç‡™®‡´Å‡™Ç ‡™â‡™™‡™ï‡™∞‡™£ ‡™è‡™ï‡´ç‡™∏‡™ö‡´á‡™®‡´ç‡™ú ‡™ï‡™∞‡´Ä‡™®‡´á ‚Çπ5,000 ‡™∏‡´Å‡™ß‡´Ä‡™®‡´ã ‡™°‡™ø‡™∏‡´ç‡™ï‡™æ‡™â‡™®‡´ç‡™ü ‡™Æ‡´á‡™≥‡™µ‡´Ä ‡™∂‡™ï‡´ã ‡™õ‡´ã.' },
      { q:/.*/, a:'‡™Æ‡™æ‡™´ ‡™ï‡™∞‡™∂‡´ã, ‡™Æ‡™æ‡™∞‡´Ä ‡™™‡™æ‡™∏‡´á ‡™§‡´á ‡™ö‡´ã‡™ï‡´ç‡™ï‡™∏ ‡™Æ‡™æ‡™π‡™ø‡™§‡´Ä ‡™â‡™™‡™≤‡™¨‡´ç‡™ß ‡™®‡™•‡´Ä. ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™ï‡™ø‡™Ç‡™Æ‡™§, ‡™ï‡´ç‡™∑‡™Æ‡™§‡™æ, ‡™µ‡´ã‡™∞‡™Ç‡™ü‡´Ä ‡™Ö‡™•‡™µ‡™æ ‡™∏‡™´‡™æ‡™à ‡™µ‡™ø‡™∂‡´á ‡™™‡´Ç‡™õ‡´ã.' }
    ];

    // SPEECH FUNCTIONS
    function speak(text, langTag){
      if(!('speechSynthesis' in window)) {
        document.getElementById('transcript').textContent = text;
        return;
      }
      const u = new SpeechSynthesisUtterance(text);
      u.lang = langTag;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(u);
    }

    // MATCH QUERY BASED ON CURRENT LANGUAGE
    function matchAndReply(text){
      const q = text.toLowerCase();
      if(currentLang === 'en'){
        const found = cannedEn.find(c => c.q.test(q)) || cannedEn[cannedEn.length-1];
        const ans = found.a;
        document.getElementById('transcript').textContent = 'Assistant: ' + ans;
        speak(ans, 'en-IN');
      } else {
        const found = cannedGu.find(c => c.q.test(q)) || cannedGu[cannedGu.length-1];
        const ans = found.a;
        document.getElementById('transcript').textContent = '‡™∏‡™π‡™æ‡™Ø‡™ï: ' + ans;
        speak(ans, 'gu-IN');
      }
    }

    // RECOGNITION SETUP
    let recognition = null;
    if(window.SpeechRecognition || window.webkitSpeechRecognition){
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SR();
      recognition.lang = 'en-IN';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
      recognition.onresult = (e) => {
        const text = e.results[0][0].transcript;
        document.getElementById('transcript').textContent = (currentLang==='en' ? 'You: ' : '‡™§‡™Æ‡´á: ') + text;
        matchAndReply(text);
      };
      recognition.onend = () => {
        document.getElementById('mic').classList.remove('listening');
      };
      recognition.onerror = (ev) => {
        document.getElementById('transcript').textContent = 'Error: ' + ev.error;
        document.getElementById('mic').classList.remove('listening');
      };
    }

    // MIC BUTTON HANDLER
    document.getElementById('mic').addEventListener('click', () => {
      const m = document.getElementById('mic');
      if(!recognition){
        const q = prompt(currentLang==='en' ? 'Type your question:' : '‡™§‡™Æ‡™æ‡™∞‡´ã ‡™™‡´ç‡™∞‡™∂‡´ç‡™® ‡™Ö‡™π‡´Ä‡™Ç ‡™ü‡™æ‡™à‡™™ ‡™ï‡™∞‡´ã:');
        if(q) matchAndReply(q);
        return;
      }
      // set recognition language based on toggle
      recognition.lang = (currentLang === 'en') ? 'en-IN' : 'gu-IN';
      try {
        m.classList.add('listening');
        document.getElementById('transcript').textContent = currentLang==='en' ? 'Listening...' : '‡™∂‡´Å‡™£‡™æ‡™µ‡´ç‡™Ø‡´ã...';
        recognition.start();
      } catch(e){
        m.classList.remove('listening');
      }
    });

    // Accessibility: allow Enter/Space to trigger mic
    document.getElementById('mic').tabIndex = 0;
    document.getElementById('mic').addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' ') e.target.click();
    });

    // jpg fallback: if browser doesn't support jpg, swap to jpg
    (function(){
      const testImg = new Image();
      testImg.onload = ()=>{};
      testImg.onerror = ()=>{
        document.querySelectorAll('img').forEach(img=>{
          img.src = img.src.replace('.jpg', '.jpg');
        });
      };
      testImg.src = 'data:image/jpg;base64,AAAA';
    })();

    // Initial language set (ensures recognition.lang updated if recognition exists)
    setLang('en');

    // small safety: pre-load images to avoid flicker
    images.forEach(i => { const img = new Image(); img.src = i.src; });
  </script>
</body>
</html>
