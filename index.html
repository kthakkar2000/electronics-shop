<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kalindi ‚Äî Samsung washing machine 12kg</title>
<style>
:root{
  --bg:#0f1723; --card:#0b1220; --muted:#9aa4b2;
  --accent1:#7c3aed; --accent2:#06b6d4;
  font-family:Inter,system-ui,-apple-system,Roboto,'Segoe UI',Arial;
}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#081018);color:#e6eef6}
.container{max-width:460px;margin:18px auto;padding:16px}
header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px; position:relative; z-index:30; pointer-events:auto}
.left{display:flex;gap:12px;align-items:center}
.logo-img{width:72px;height:72px;border-radius:12px;overflow:hidden;box-shadow:0 8px 26px rgba(2,6,23,0.6);background:#fff;flex-shrink:0}
.logo-img img{width:100%;height:100%;object-fit:contain}
.title-wrap{line-height:1}
.shop{font-size:16px;font-weight:800}
.sub{font-size:12px;color:var(--muted)}
.lang-switch{display:flex;gap:8px}
.lang-btn{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted);font-weight:700;cursor:pointer;outline:none}
.lang-btn.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;box-shadow:0 8px 22px rgba(124,58,237,0.12)}
.lang-btn:focus{box-shadow:0 0 0 3px rgba(7,125,255,0.12)}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:18px;padding:12px;box-shadow:0 10px 30px rgba(2,6,23,0.6)}
.gallery{position:relative;overflow:hidden;border-radius:14px}
.slides{display:flex;transition:transform .36s cubic-bezier(.2,.9,.2,1)}
.slides img{width:100%;height:320px;object-fit:cover;flex-shrink:0;background:#071018}
.dots{display:flex;gap:6px;position:absolute;left:12px;bottom:10px;z-index:15}
.dot{width:9px;height:9px;border-radius:6px;background:rgba(255,255,255,0.06)}
.dot.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));box-shadow:0 6px 18px rgba(6,182,212,0.08)}
.product-name{font-weight:900;font-size:18px;margin-top:12px;text-align:center}
.bot{display:flex;gap:12px;align-items:center;margin-top:14px;padding:12px;border-radius:12px;background:linear-gradient(90deg, rgba(124,58,237,0.05), rgba(6,182,212,0.03)); position:relative; z-index:20}
.mic{width:56px;height:56px;border-radius:12px;background:linear-gradient(180deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff;font-size:20px;cursor:pointer;flex-shrink:0;pointer-events:auto;border:0}
.mic.listening{box-shadow:0 12px 40px rgba(124,58,237,0.18);transform:scale(1.04)}
.bot-info{flex:1}
.bot-title{font-weight:800}
.bot-sub{font-size:13px;color:var(--muted);margin-top:6px}
.transcript{margin-top:8px;font-size:14px;color:var(--muted);min-height:46px}
footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
@media (max-width:420px){ .slides img{height:260px} }
.img-error{position:absolute;left:12px;top:12px;padding:8px 10px;border-radius:8px;background:rgba(0,0,0,0.48);color:#ffcccc;font-size:13px}
.small-muted{color:var(--muted);font-size:13px;margin-top:6px}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="left">
      <div class="logo-img"><img id="logoImg" src="assets/ktpl-new-logo.png" alt="Kalindi logo"/></div>
      <div class="title-wrap">
        <div class="shop">Kalindi Tradelinks Pvt Ltd</div>
        <div class="sub">Home Appliances ‚Ä¢ Washing Machine</div>
      </div>
    </div>

    <div class="lang-switch" role="tablist" aria-label="Language">
      <button class="lang-btn active" id="btn-en" aria-selected="true">English</button>
      <button class="lang-btn" id="btn-gu" aria-selected="false">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</button>
    </div>
  </header>

  <main class="card">
    <div class="gallery" id="gallery">
      <div class="slides" id="slides">
        <img src="assets/wm1.jpg" alt="product image 1" />
        <img src="assets/wm2.jpg" alt="product image 2" />
        <img src="assets/wm3.jpg" alt="product image 3" />
        <img src="assets/wm4.jpg" alt="product image 4" />
        <img src="assets/wm5.jpg" alt="product image 5" />
      </div>
      <div class="dots" id="dots" aria-hidden="true"></div>
      <div class="img-error" id="imgError" style="display:none">Image not found ‚Äî check assets folder</div>
    </div>

    <div class="product-name">Samsung washing machine 12kg</div>
    <div class="small-muted" style="text-align:center">Tap the mic and ask. Responses available in English and Gujarati.</div>

    <div class="bot" role="region" aria-label="Product voice assistant">
      <button class="mic" id="mic" title="Tap to speak" aria-pressed="false">üéôÔ∏è</button>
      <div class="bot-info">
        <div class="bot-title" id="assistant-title">Product Voice Assistant</div>
        <div class="bot-sub" id="assistant-sub">Select language, tap mic and ask about price, warranty, usage and more.</div>
        <div class="transcript" id="transcript">Assistant ready. Select language and tap mic to ask.</div>
      </div>
    </div>
  </main>

  <footer>¬© Kalindi Tradelinks Pvt Ltd</footer>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  /* slider */
  const slides = document.getElementById('slides'), imgs = slides.querySelectorAll('img'), dots = document.getElementById('dots');
  let idx = 0;
  function buildDots(){ dots.innerHTML=''; imgs.forEach((_,i)=>{ const d=document.createElement('div'); d.className='dot'+(i===0 ? ' active':''); d.addEventListener('click',()=>{ idx=i; update(); }); dots.appendChild(d); }); }
  function update(){ slides.style.transform = `translateX(${-idx*100}%)`; Array.from(dots.children).forEach((d,i)=> d.classList.toggle('active', i===idx)); }
  buildDots(); setInterval(()=>{ idx=(idx+1)%imgs.length; update(); },4500);
  let startX=null; const gallery=document.getElementById('gallery');
  gallery.addEventListener('touchstart', e=> startX = e.changedTouches[0].clientX);
  gallery.addEventListener('touchend', e=>{ if(startX===null) return; const endX = e.changedTouches[0].clientX; const dx = endX - startX; if(Math.abs(dx)>40){ if(dx<0) idx = Math.min(idx+1, imgs.length-1); else idx = Math.max(idx-1,0); update(); } startX=null; });

  /* language toggle */
  let currentLang='en';
  const btnEn = document.getElementById('btn-en'), btnGu = document.getElementById('btn-gu');
  function setLang(lang){
    currentLang = lang;
    if(lang==='en'){
      btnEn.classList.add('active'); btnEn.setAttribute('aria-selected','true'); btnGu.classList.remove('active'); btnGu.setAttribute('aria-selected','false');
      document.getElementById('assistant-sub').textContent = 'Select language, tap mic and ask about price, warranty, usage and more.';
      document.getElementById('assistant-title').textContent = 'Product Voice Assistant';
      if(typeof recognition !== 'undefined' && recognition) recognition.lang = 'en-IN';
    } else {
      btnGu.classList.add('active'); btnGu.setAttribute('aria-selected','true'); btnEn.classList.remove('active'); btnEn.setAttribute('aria-selected','false');
      document.getElementById('assistant-sub').textContent = '‡™≠‡™æ‡™∑‡™æ ‡™™‡™∏‡™Ç‡™¶ ‡™ï‡™∞‡´ã, ‡™Æ‡™æ‡™à‡™ï ‡™¶‡™¨‡™æ‡™µ‡´ã ‡™Ö‡™®‡´á ‡™ï‡™ø‡™Ç‡™Æ‡™§, ‡™µ‡´ã‡™∞‡™Ç‡™ü‡´Ä, ‡™â‡™™‡™Ø‡´ã‡™ó ‡™µ‡™ó‡´á‡™∞‡´á ‡™µ‡™ø‡™∂‡´á ‡™™‡´Ç‡™õ‡´ã.';
      document.getElementById('assistant-title').textContent = '‡™™‡´ç‡™∞‡´ã‡™°‡™ï‡´ç‡™ü ‡™µ‡´ã‡™á‡™∏ ‡™Ü‡™∏‡™ø‡™∏‡´ç‡™ü‡™®‡´ç‡™ü';
      if(typeof recognition !== 'undefined' && recognition) recognition.lang = 'gu-IN';
    }
  }
  btnEn.addEventListener('click', ()=> setLang('en'));
  btnGu.addEventListener('click', ()=> setLang('gu'));

  /* canned replies (EN/ GU) ‚Äî same as before, truncated for brevity here (kept full in original) */
  const cannedEn = [
    { q:/price|cost|‚Çπ|rupee/i, a:'This model costs ‚Çπ65,000. For offers and EMI options, please ask the store person.' },
    { q:/usage|how to use|use of|how do i use|what is the use/i, a:'Load items evenly, use recommended detergent, select the program suitable for the load, and avoid overloading.' },
    { q:/water|litre|consumption/i, a:'This model uses approximately 50‚Äì70 liters of water per full wash depending on program.' },
    { q:/colour|color|available color|which color/i, a:'Common colours: Pearl White, Graphite/Black, Silver - availability varies by model.' },
    { q:/dimension|size|height|width|depth/i, a:'Typical dimensions: H ~85 cm √ó W ~60 cm √ó D ~55‚Äì70 cm depending on exact model.' },
    { q:/electric|power|watt|energy|consumption/i, a:'Average electricity per full wash is roughly 1.2‚Äì1.5 kWh; eco modes use less.' },
    { q:/feedback|reviews|customer review/i, a:`Customer feedback (sample): 1) Great cleaning, gentle on clothes. 2) Large drum ‚Äî perfect for blankets. 3) Smart features are useful. 4) Quiet and low vibration.` },
    { q:/describe|description|model description|details/i, a:`Samsung 12 kg front-load washers usually feature Digital Inverter motors, AI/EcoBubble wash options, multiple programs (Quick, Eco, Hygiene), and SmartThings support on select models.` },
    { q:/advantages|why should i buy|benefit/i, a:`Advantages: large capacity, efficient inverter motor, advanced wash tech, energy-saving cycles and smart features on some models.` },
    { q:/smaller|instead of a smaller capacity/i, a:`12kg saves time and energy by handling bulky items and large loads in fewer cycles compared to smaller machines.` },
    { q:/other brands|better than other brands/i, a:`Samsung offers features like EcoBubble/AI Wash and SmartThings ‚Äî exact advantage depends on the specific models compared.` },
    { q:/programs|quick wash|eco wash/i, a:'Yes ‚Äî many models include Quick Wash, Eco and specialized programs for delicates and bedding.' },
    { q:/heavy loads|blankets|curtains/i, a:'Yes ‚Äî 12 kg capacity is suitable for heavy/bulky items like blankets and curtains.' },
    { q:/.*/, a:'Sorry, I do not have that exact information. Ask about price, usage, water consumption, warranty or features.' },
    { q:/stock|available|availablity/i, a:'Only 3 pieces left in stock. Hurry! For EMI and exchange offers, please ask the store person.'}
  ];
  const cannedGu = [
    { q:/‡™ï‡™ø‡™Ç‡™Æ‡™§|‡™¶‡™æ‡™Æ|‡™∞‡´Ç|‚Çπ/i, a:'‡™Ü ‡™Æ‡´ã‡™°‡™≤‡™®‡´Ä ‡™ï‡™ø‡™Ç‡™Æ‡™§ ‚Çπ65,000 ‡™õ‡´á. ‡™ë‡™´‡™∞‡´ç‡™∏ ‡™Ö‡™®‡´á EMI ‡™µ‡™ø‡™ï‡™≤‡´ç‡™™‡´ã ‡™Æ‡™æ‡™ü‡´á ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™∏‡´ç‡™ü‡´ã‡™∞ ‡™™‡™∞‡´ç‡™∏‡™®‡™®‡´á ‡™™‡´Ç‡™õ‡´ã.' },
    { q:/‡™â‡™™‡™Ø‡´ã‡™ó|‡™ï‡´á‡™µ‡´Ä ‡™∞‡´Ä‡™§‡´á ‡™µ‡™æ‡™™‡™∞‡™µ‡´Å‡™Ç/i, a:'‡™∏‡™æ‡™Æ‡™æ‡™®‡´ç‡™Ø ‡™∞‡´Ä‡™§‡´á ‡™∏‡™Æ‡™æ‡™® ‡™∞‡´Ä‡™§‡´á ‡™≤‡´ã‡™° ‡™ï‡™∞‡´ã, ‡™∏‡´Ç‡™ö‡™ø‡™§ ‡™°‡™ø‡™ü‡™∞‡´ç‡™ú‡™®‡´ç‡™ü ‡™µ‡™æ‡™™‡™∞‡´ã ‡™Ö‡™®‡´á ‡™ì‡™µ‡™∞‡™≤‡´ã‡™° ‡™ü‡™æ‡™≥‡´ã.' },
    { q:/‡™™‡™æ‡™£‡´Ä|‡™≤‡™ø‡™ü‡™∞|‡™â‡™™‡™Ø‡´ã‡™ó/i, a:'‡™≠‡™∞‡™®‡™æ ‡™µ‡´ã‡™∂ ‡™Æ‡™æ‡™ü‡´á ‡™≤‡™ó‡™≠‡™ó 50‚Äì70 ‡™≤‡™ø‡™ü‡™∞ ‡™™‡™æ‡™£‡´Ä ‡™µ‡™™‡™∞‡™æ‡™Ø ‡™õ‡´á (‡™™‡´ç‡™∞‡´ã‡™ó‡´ç‡™∞‡™æ‡™Æ ‡™™‡™∞ ‡™Ü‡™ß‡™æ‡™∞).' },
    { q:/‡™∞‡™Ç‡™ó|‡™â‡™™‡™≤‡™¨‡´ç‡™ß ‡™∞‡™Ç‡™ó/i, a:'‡™™‡´ç‡™∞‡™ß‡™æ‡™® ‡™∞‡™Ç‡™ó‡´ã: ‡™™‡™∞‡´ç‡™≤ ‡™µ‡´ç‡™π‡™æ‡™á‡™ü, ‡™ó‡´ç‡™∞‡™æ‡™´‡™æ‡™á‡™ü/‡™¨‡´ç‡™≤‡´á‡™ï, ‡™∏‡™ø‡™≤‡´ç‡™µ‡™∞ ‚Äî ‡™Æ‡´ã‡™°‡´á‡™≤ ‡™Ö‡™®‡´á ‡™∏‡´ç‡™ü‡´ã‡™ï ‡™™‡™∞ ‡™Ü‡™ß‡™æ‡™∞.' },
    { q:/‡™™‡™∞‡™ø‡™Æ‡™æ‡™£|‡™Æ‡™æ‡™™|‡™°‡™æ‡™Ø‡™Æ‡´á‡™®‡´ç‡™∂‡™®/i, a:'‡™Ü‡™Æ –∫–ª–∏–µ–Ω—Ç–∞ ‡™Æ‡™æ‡™™: H ~85 cm √ó W ~60 cm √ó D ~55‚Äì70 cm (‡™Æ‡´ã‡™°‡´á‡™≤ ‡™™‡´ç‡™∞‡™Æ‡™æ‡™£‡´á).' },
    { q:/‡™µ‡™ø‡™¶‡´ç‡™Ø‡´Å‡™§|‡™™‡™æ‡™µ‡™∞|‡™â‡™∞‡´ç‡™ú‡™æ/i, a:'‡™™‡´Ç‡™∞‡™§‡™æ ‡™µ‡´ã‡™∂ ‡™Æ‡™æ‡™ü‡´á ‡™Ö‡™Ç‡™¶‡™æ‡™ú‡´á 1.2‚Äì1.5 kWh; ‡™è‡™ï‡´ã ‡™Æ‡´ã‡™° ‡™ì‡™õ‡´Å‡™Ç ‡™µ‡™™‡™∞‡™æ‡™Ø ‡™õ‡´á.' },
    { q:/‡™™‡´ç‡™∞‡™§‡™ø‡™≠‡™æ‡™µ|‡™∞‡´Ä‡™µ‡´ç‡™Ø‡´Å‡™ù/i, a:'‡™ó‡´ç‡™∞‡™æ‡™π‡™ï ‡™™‡´ç‡™∞‡™§‡™ø‡™∏‡™æ‡™¶: 1) ‡™∏‡™æ‡™∞‡´Ä ‡™∏‡™æ‡™´‡™∏‡™´‡™æ‡™á. 2) ‡™Æ‡´ã‡™ü‡´Ä ÎìúÎüº. 3) ‡™∏‡´ç‡™Æ‡™æ‡™∞‡´ç‡™ü ‡™´‡´Ä‡™ö‡™∞‡´ç‡™∏ ‡™Æ‡™¶‡™¶ ‡™ï‡™∞‡´á ‡™õ‡´á. 4) ‡™∂‡™æ‡™Ç‡™§ ‡™ì‡™™‡™∞‡´á‡™∂‡™®.' },
    { q:/‡™µ‡™∞‡´ç‡™£‡™®|‡™°‡™ø‡™∏‡´ç‡™ï‡´ç‡™∞‡™ø‡™™‡´ç‡™∂‡™®|‡™Æ‡´ã‡™°‡´á‡™≤ ‡™µ‡™∞‡´ç‡™£‡™®/i, a:'Samsung 12 kg ‡™´‡´ç‡™∞‡™®‡´ç‡™ü-‡™≤‡´ã‡™° ‡™Æ‡™∂‡´Ä‡™®‡´ã‡™Æ‡™æ‡™Ç ‡™°‡™ø‡™ú‡™ø‡™ü‡™≤ ‡™á‡™®‡™µ‡™∞‡´ç‡™ü‡™∞, AI/EcoBubble ‡™§‡™ï‡™®‡´Ä‡™ï ‡™Ö‡™®‡´á ‡™ò‡™£‡™æ ‡™∏‡´ç‡™™‡´á‡™∂‡´ç‡™Ø‡™≤ ‡™™‡´ç‡™∞‡´ã‡™ó‡´ç‡™∞‡™æ‡™Æ‡´ç‡™∏ ‡™ú‡´ã‡™µ‡™æ ‡™Æ‡™≥‡´á ‡™õ‡´á.' },
    { q:/‡™≤‡™æ‡™≠|‡™∂‡™æ ‡™Æ‡™æ‡™ü‡´á ‡™ñ‡™∞‡´Ä‡™¶‡™µ‡´Å‡™Ç/i, a:'‡™≤‡™æ‡™≠: ‡™Æ‡´ã‡™ü‡´Ä ‡™ï‡´ç‡™∑‡™Æ‡™§‡™æ, ‡™á‡™®‡™µ‡™∞‡´ç‡™ü‡™∞ ‡™Æ‡´ã‡™ü‡™∞, ‡™è‡™°‡™µ‡™æ‡™®‡´ç‡™∏‡´ç‡™° ‡™µ‡´ã‡™∂ ‡™ü‡´á‡™ï, ‡™ä‡™∞‡´ç‡™ú‡™æ ‡™¨‡™ö‡™§ ‡™Ö‡™®‡´á ‡™∏‡´ç‡™Æ‡™æ‡™∞‡´ç‡™ü ‡™´‡´Ä‡™ö‡™∞‡´ç‡™∏.' },
    { q:/‡™®‡™æ‡™®‡´Ä ‡™ï‡´ç‡™∑‡™Æ‡™§‡™æ|‡™ï‡´á‡™µ‡´Ä ‡™∞‡´Ä‡™§‡´á ‡™®‡™æ‡™®‡´Ä/i, a:'12 kg ‡™è‡™ï ‡™ú ‡™µ‡™ñ‡™§‡™Æ‡™æ‡™Ç ‡™Æ‡´ã‡™ü‡´Ä ‡™µ‡™∏‡´ç‡™§‡´Å‡™ì ‡™ß‡´ã‡™à ‡™∂‡™ï‡™∂‡´á ‡™ú‡´á‡™•‡´Ä ‡™¨‡™ß‡™æ ‡™ì‡™õ‡™æ ‡™∏‡™æ‡™Ø‡™ï‡™≤‡™Æ‡™æ‡™Ç ‡™•‡™æ‡™Ø.' },
    { q:/.*/, a:'‡™Æ‡™æ‡™´ ‡™ï‡™∞‡™∂‡´ã, ‡™Æ‡™®‡´á ‡™§‡´á ‡™ö‡´ã‡™ï‡´ç‡™ï‡™∏ ‡™Æ‡™æ‡™π‡™ø‡™§‡´Ä ‡™â‡™™‡™≤‡™¨‡´ç‡™ß ‡™®‡™•‡´Ä. ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™´‡™∞‡´Ä‡™•‡´Ä ‡™™‡´ç‡™∞‡™∂‡´ç‡™® ‡™™‡´Ç‡™õ‡´ã.' }
    { q:/‡™π‡™æ‡™≤‡™Æ‡™æ‡™Ç ‡™∏‡´ç‡™ü‡´ã‡™ï‡™Æ‡™æ‡™Ç ‡™õ‡´á?|‡™ï‡´á‡™ü‡™≤‡™æ ‡™™‡´Ä‡™∏ ‡™∏‡´ç‡™ü‡´ã‡™ï‡™Æ‡™æ‡™Ç ‡™õ‡´á?|‡™Ü ‡™Æ‡´ã‡™°‡™≤ ‡™π‡™æ‡™≤ ‡™¶‡´Å‡™ï‡™æ‡™®‡™Æ‡™æ‡™Ç ‡™õ‡´á?/i, a:'‡™Æ‡™æ‡™§‡´ç‡™∞ 3 ‡™™‡´Ä‡™∏ ‡™∏‡´ç‡™ü‡´ã‡™ï‡™Æ‡™æ‡™Ç ‡™¨‡™æ‡™ï‡´Ä ‡™õ‡´á. ‡™ú‡™≤‡´ç‡™¶‡´Ä ‡™ï‡™∞‡´ã! EMI ‡™Ö‡™®‡´á ‡™è‡™ï‡´ç‡™∏‡™ö‡´á‡™®‡´ç‡™ú ‡™ë‡™´‡™∞‡´ç‡™∏ ‡™Æ‡™æ‡™ü‡´á ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™∏‡´ç‡™ü‡´ã‡™∞ ‡™™‡™∞‡´ç‡™∏‡™®‡™®‡´á ‡™™‡´Ç‡™õ‡´ã.' },
  
  ];

  /* speech synth + tap sound */
  function speak(text, lang='en-IN'){ if(!('speechSynthesis' in window)){ document.getElementById('transcript').textContent = text; return; } const u = new SpeechSynthesisUtterance(text); u.lang = lang; u.rate = 1; window.speechSynthesis.cancel(); window.speechSynthesis.speak(u); }
  let audioCtx=null;
  function playTap(){ try{ if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); const now = audioCtx.currentTime; const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type='sine'; o.frequency.setValueAtTime(1000, now); g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.12, now + 0.001); g.gain.exponentialRampToValueAtTime(0.001, now + 0.12); o.connect(g); g.connect(audioCtx.destination); o.start(now); o.stop(now + 0.14); }catch(e){ console.warn('tap sound', e && e.message); } }

  /* recognition with empty result handling */
  let recognition = null;
  let lastHeard = false;
  if(window.SpeechRecognition || window.webkitSpeechRecognition){
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SR();
    recognition.lang = 'en-IN';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onresult = (e) => {
      lastHeard = true;
      const text = e.results[0][0].transcript;
      document.getElementById('transcript').textContent = (currentLang==='en' ? 'You: ' : '‡™§‡™Æ‡´á: ') + text;
      handleQuery(text);
    };

    recognition.onend = () => {
      document.getElementById('mic').classList.remove('listening');
      if(!lastHeard){
        document.getElementById('transcript').textContent = (currentLang==='en' ? 'Tap mic to speak' : '‡™Æ‡™æ‡™á‡™ï ‡™¶‡™¨‡™æ‡™µ‡´ã ‡™Ö‡™®‡´á ‡™¨‡´ã‡™≤‡´ã');
      }
      lastHeard = false;
    };

    recognition.onerror = (ev) => {
      document.getElementById('transcript').textContent = 'Error: ' + (ev.error || ev.message);
      document.getElementById('mic').classList.remove('listening');
      lastHeard = false;
    };
  }

  /* handle query */
  function handleQuery(text){
    const q = text.toLowerCase();
    if(currentLang === 'en'){
      const found = cannedEn.find(c => c.q.test(q)) || cannedEn[cannedEn.length-1];
      const ans = found.a;
      document.getElementById('transcript').textContent = 'Assistant: ' + ans;
      speak(ans, 'en-IN');
    } else {
      const found = cannedGu.find(c => c.q.test(q)) || cannedGu[cannedGu.length-1];
      const ans = found.a;
      document.getElementById('transcript').textContent = '‡™∏‡™π‡™æ‡™Ø‡™ï: ' + ans;
      speak(ans, 'gu-IN');
    }
  }

  /* mic behavior */
  const micBtn = document.getElementById('mic');
  micBtn.addEventListener('click', () => {
    playTap();
    if(!recognition){
      const q = prompt(currentLang==='en' ? 'Type your question:' : '‡™§‡™Æ‡™æ‡™∞‡´ã ‡™™‡´ç‡™∞‡™∂‡´ç‡™® ‡™Ö‡™π‡´Ä‡™Ç ‡™ü‡™æ‡™à‡™™ ‡™ï‡™∞‡´ã:');
      if(q) handleQuery(q);
      return;
    }
    recognition.lang = (currentLang === 'en') ? 'en-IN' : 'gu-IN';
    try{
      lastHeard = false;
      micBtn.classList.add('listening');
      document.getElementById('transcript').textContent = (currentLang==='en' ? 'Listening...' : '‡™∂‡´Å‡™£‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™Ü‡™µ‡´Ä ‡™∞‡™π‡´ç‡™Ø‡´Å‡™Ç ‡™õ‡´á...');
      recognition.start();
    }catch(e){
      micBtn.classList.remove('listening');
      document.getElementById('transcript').textContent = (currentLang==='en' ? 'Tap mic to speak' : '‡™Æ‡™æ‡™á‡™ï ‡™¶‡™¨‡™æ‡™µ‡´ã ‡™Ö‡™®‡´á ‡™¨‡´ã‡™≤‡´ã');
    }
  });
  micBtn.tabIndex = 0;
  micBtn.addEventListener('keydown', e => { if(e.key === 'Enter' || e.key === ' ') e.target.click(); });

  /* initial language */
  setLang('en');

}); // DOMContentLoaded end
</script>
</body>
</html>

